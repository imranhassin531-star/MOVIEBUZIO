<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieHub - Watch & Download Movies & Series</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #0f0f1a;
            --secondary-color: #1a1a2e;
            --accent-color: #4cc9f0;
            --text-color: #f8f9fa;
        }
        
        body {
            background-color: var(--primary-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background-color: var(--secondary-color) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .navbar.scrolled {
            background: rgba(15, 15, 26, 0.95) !important;
            padding: 10px 0;
        }
        
        .movie-card, .series-card {
            background: var(--secondary-color);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            height: 100%;
            border: 1px solid rgba(76, 201, 240, 0.1);
        }
        
        .movie-card:hover, .series-card:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }
        
        .movie-poster, .series-poster {
            height: 190px;
            object-fit: cover;
            transition: all 0.3s ease;
            width: 100%;
            filter: brightness(0.9);
        }
        
        .movie-card:hover .movie-poster, .series-card:hover .series-poster {
            filter: brightness(1.05);
            transform: scale(1.02);
        }
        
        .movie-title, .series-title {
            font-size: 0.7rem; /* Text size made even smaller */
            font-weight: 500;
            margin-bottom: 0;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2em;
        }
        
        .category-btn {
            background: transparent;
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
            margin: 5px;
            transition: all 0.3s ease;
            border-radius: 20px;
            padding: 5px 15px;
            font-size: 0.9rem;
        }
        
        .category-btn:hover, .category-btn.active {
            background: var(--accent-color);
            color: var(--primary-color);
            box-shadow: 0 0 15px rgba(76, 201, 240, 0.3);
        }
        
        .btn-download {
            background: var(--accent-color);
            color: var(--primary-color);
            font-weight: bold;
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        
        .btn-download:hover {
            background: #3aa8d8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 201, 240, 0.3);
        }
        
        .search-box {
            background: var(--secondary-color);
            border: 1px solid rgba(76, 201, 240, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            transition: all 0.3s ease;
        }
        
        .search-box:focus {
            background: var(--secondary-color);
            color: white;
            box-shadow: 0 0 0 0.25rem rgba(76, 201, 240, 0.25);
            border-color: var(--accent-color);
        }
        
        .category-badge {
            background: rgba(76, 201, 240, 0.2);
            color: var(--accent-color);
            margin-right: 5px;
            margin-bottom: 5px;
            display: inline-block;
            border-radius: 10px;
            padding: 5px 10px;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }
        
        .category-badge:hover {
            background: var(--accent-color);
            color: var(--primary-color);
        }
        
        .movie-duration, .series-episodes {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .floating {
            animation: floating 6s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }
        
        /* Default layout for mobile (3 columns) */
        .movie-col, .series-col {
            flex: 0 0 33.333%;
            max-width: 33.333%;
            padding: 0 8px;
            margin-bottom: 20px;
        }
        
        /* Layout for large screens (4 columns) */
        @media (min-width: 992px) {
            .movie-col, .series-col {
                flex: 0 0 25%;
                max-width: 25%;
            }
        }
        
        .nav-tabs {
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .nav-tabs .nav-link {
            color: var(--text-color);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            background: transparent;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--accent-color);
            background: transparent;
            border-bottom: 3px solid var(--accent-color);
        }
        
        .nav-tabs .nav-link:hover:not(.active) {
            color: var(--accent-color);
            opacity: 0.8;
        }
        
        .quality-btn {
            background: rgba(76, 201, 240, 0.1);
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            border-radius: 5px;
            padding: 5px 10px;
            margin: 0 5px 5px 0;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }
        
        .quality-btn:hover {
            background: var(--accent-color);
            color: var(--primary-color);
        }

        /* New styles for season/episode navigation */
        .season-nav {
            display: flex;
            overflow-x: auto;
            margin-bottom: 15px;
            padding-bottom: 5px;
        }
        
        .season-btn {
            background: transparent;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            margin-right: 10px;
            padding: 5px 15px;
            border-radius: 20px;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        
        .season-btn.active {
            background: var(--accent-color);
            color: var(--primary-color);
        }
        
        .episode-list {
            display: none;
        }
        
        .episode-list.active {
            display: block;
        }
        
        .episode-item {
            background: rgba(76, 201, 240, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .episode-item:hover {
            background: rgba(76, 201, 240, 0.2);
        }
        
        .episode-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .episode-download {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand animate__animated animate__fadeInLeft" href="#">
                <i class="fas fa-film me-2 floating"></i>MovieHub
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto animate__animated animate__fadeInRight">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-bs-toggle="tab" data-bs-target="#movies-tab">Movies</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="tab" data-bs-target="#series-tab">Series</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Categories</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Search and Filter Section -->
    <div class="container py-4 mt-5">
        <div class="row animate__animated animate__fadeIn animate__delay-1s">
            <div class="col-md-8 mb-3">
                <div class="search-container">
                    <input type="text" id="searchInput" class="form-control search-box" placeholder="Search movies or series...">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <select id="categoryFilter" class="form-select search-box">
                    <option value="all">All Categories</option>
                    <!-- Categories will be loaded here -->
                </select>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="container">
        <ul class="nav nav-tabs" id="contentTabs">
            <li class="nav-item">
                <a class="nav-link active" id="movies-tab-btn" data-bs-toggle="tab" href="#movies-tab">Movies</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="series-tab-btn" data-bs-toggle="tab" href="#series-tab"> Series</a>
            </li>
        </ul>
    </div>

    <!-- Movies Tab Content -->
    <div class="tab-content">
        <div class="tab-pane fade show active" id="movies-tab">
            <div class="container py-3">
                <div class="row" id="moviesGrid">
                    <div class="col-12 text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Series Tab Content -->
        <div class="tab-pane fade" id="series-tab">
            <div class="container py-3">
                <div class="row" id="seriesGrid">
                    <div class="col-12 text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Movie Details Modal -->
    <div class="modal fade" id="movieDetailsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content" style="background: var(--secondary-color); border: 1px solid var(--accent-color);">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="movieModalTitle">Movie Title</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <img id="modalMoviePoster" src="" class="img-fluid rounded floating" alt="Movie Poster">
                        </div>
                        <div class="col-md-8">
                            <p id="modalMovieDescription" class="mb-3">Loading description...</p>
                            <div class="d-flex flex-wrap mb-3" id="modalMovieCategories">
                                <!-- Categories will be loaded here -->
                            </div>
                            <div class="d-flex flex-wrap mb-3">
                                <span class="badge bg-secondary me-2 mb-2" id="modalMovieYear">Year</span>
                                <span class="badge bg-success me-2 mb-2" id="modalMovieRating">Rating</span>
                                <span class="badge bg-info me-2 mb-2" id="modalMovieDuration">Duration</span>
                            </div>
                            <h6 class="mt-3">Download Links</h6>
                            <div id="modalMovieDownloadLinks" class="d-flex flex-wrap">
                                <!-- Download quality buttons will be injected here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Series Details Modal -->
    <div class="modal fade" id="seriesDetailsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content" style="background: var(--secondary-color); border: 1px solid var(--accent-color);">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="seriesModalTitle">Series Title</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <img id="modalSeriesPoster" src="" class="img-fluid rounded floating" alt="Series Poster">
                        </div>
                        <div class="col-md-8">
                            <p id="modalSeriesDescription" class="mb-3">Loading description...</p>
                            <div class="d-flex flex-wrap mb-3" id="modalSeriesCategories">
                                <!-- Categories will be loaded here -->
                            </div>
                            <div class="d-flex flex-wrap mb-3">
                                <span class="badge bg-secondary me-2 mb-2" id="modalSeriesYear">Year</span>
                                <span class="badge bg-success me-2 mb-2" id="modalSeriesRating">Rating</span>
                                <span class="badge bg-info me-2 mb-2" id="modalSeriesSeasons">Seasons</span>
                                <span class="badge bg-warning me-2 mb-2" id="modalSeriesEpisodes">Episodes</span>
                            </div>
                            
                            <!-- Season Navigation -->
                            <div class="mb-3">
                                <h6>Seasons:</h6>
                                <div class="season-nav" id="seasonNav">
                                    <!-- Seasons will be loaded here -->
                                </div>
                            </div>
                            
                            <!-- Episode Lists -->
                            <div id="episodesContainer">
                                <!-- Episodes will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBPOmDcmOZvwy9ERJH00RKrOaJOJFlQ1FA",
            authDomain: "ff-tournament-3314c.firebaseapp.com",
            databaseURL: "https://ff-tournament-3314c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "ff-tournament-3314c",
            storageBucket: "ff-tournament-3314c.firebasestorage.app",
            messagingSenderId: "651300633868",
            appId: "1:651300633868:web:6bf086333189721e2edd29",
            measurementId: "G-KQBHWWYXR4"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Global variables
        let allMovies = {};
        let allSeries = {};
        let allCategories = {};
        let currentCategory = 'all';
        let currentSearch = '';
        const movieDetailsModal = new bootstrap.Modal(document.getElementById('movieDetailsModal'));
        const seriesDetailsModal = new bootstrap.Modal(document.getElementById('seriesDetailsModal'));
        
        // Navbar scroll effect
        window.addEventListener('scroll', function() {
            if (window.scrollY > 50) {
                document.querySelector('.navbar').classList.add('scrolled');
            } else {
                document.querySelector('.navbar').classList.remove('scrolled');
            }
        });
        
        // Load data
        function loadData() {
            // Load categories
            database.ref('categories').on('value', (snapshot) => {
                allCategories = snapshot.val() || {};
                populateCategoryFilter();
            });
            
            // Load movies
            database.ref('movies').on('value', (snapshot) => {
                allMovies = snapshot.val() || {};
                renderMovies();
            });
            
            // Load series
            database.ref('series').on('value', (snapshot) => {
                allSeries = snapshot.val() || {};
                renderSeries();
            });
        }
        
        // Populate category filter dropdown
        function populateCategoryFilter() {
            const filter = document.getElementById('categoryFilter');
            filter.innerHTML = '<option value="all">All Categories</option>';
            
            for (const key in allCategories) {
                const category = allCategories[key];
                filter.innerHTML += `<option value="${key}">${category.name}</option>`;
            }
            
            // Add event listener for category filter
            filter.addEventListener('change', function() {
                currentCategory = this.value;
                renderMovies();
                renderSeries();
            });
        }
        
        // Add search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            currentSearch = this.value.toLowerCase();
            renderMovies();
            renderSeries();
        });
        
        // Render movies based on filters
        function renderMovies() {
            const grid = document.getElementById('moviesGrid');
            grid.innerHTML = '';
            
            if (Object.keys(allMovies).length === 0) {
                grid.innerHTML = '<div class="col-12 text-center"><p>No movies found</p></div>';
                return;
            }
            
            let hasResults = false;
            let delay = 0;
            
            for (const key in allMovies) {
                const movie = allMovies[key];
                
                // Get categories array
                const categories = Array.isArray(movie.categories) ? movie.categories : [];
                
                // Filter by category
                if (currentCategory !== 'all' && !categories.includes(currentCategory)) {
                    continue;
                }
                
                // Filter by search term
                if (currentSearch && !movie.title.toLowerCase().includes(currentSearch)) {
                    continue;
                }
                
                hasResults = true;
                                
                // Format duration
                const duration = movie.duration ? `${movie.duration} min` : 'N/A';
                
                grid.innerHTML += `
                    <div class="movie-col animate__animated animate__fadeIn" style="animation-delay: ${delay}ms">
                        <div class="movie-card h-100" onclick="showMovieDetails('${key}')">
                            <div style="position: relative;">
                                <img src="${movie.posterUrl || 'https://via.placeholder.com/300x450'}" 
                                     class="movie-poster w-100" alt="${movie.title}">
                                <span class="movie-duration">${duration}</span>
                            </div>
                            <div class="p-2"> 
                                <h5 class="movie-title">${movie.title}</h5>
                            </div>
                        </div>
                    </div>
                `;
                
                delay += 100;
            }
            
            if (!hasResults) {
                grid.innerHTML = '<div class="col-12 text-center"><p>No movies match your search</p></div>';
            }
        }
        
        // Render series based on filters
        function renderSeries() {
            const grid = document.getElementById('seriesGrid');
            grid.innerHTML = '';
            
            if (Object.keys(allSeries).length === 0) {
                grid.innerHTML = '<div class="col-12 text-center"><p>No series found</p></div>';
                return;
            }
            
            let hasResults = false;
            let delay = 0;
            
            for (const key in allSeries) {
                const series = allSeries[key];
                
                // Get categories array
                const categories = Array.isArray(series.categories) ? series.categories : [];
                
                // Filter by category
                if (currentCategory !== 'all' && !categories.includes(currentCategory)) {
                    continue;
                }
                
                // Filter by search term
                if (currentSearch && !series.title.toLowerCase().includes(currentSearch)) {
                    continue;
                }
                
                hasResults = true;
                
                // Calculate total episodes
                let totalEpisodes = 0;
                if (series.seasons) {
                    for (const season in series.seasons) {
                        if (series.seasons[season].episodes) {
                            totalEpisodes += Object.keys(series.seasons[season].episodes).length;
                        }
                    }
                }
                
                grid.innerHTML += `
                    <div class="series-col animate__animated animate__fadeIn" style="animation-delay: ${delay}ms">
                        <div class="series-card h-100" onclick="showSeriesDetails('${key}')">
                            <div style="position: relative;">
                                <img src="${series.posterUrl || 'https://via.placeholder.com/300x450'}" 
                                     class="series-poster w-100" alt="${series.title}">
                                <span class="series-episodes">${totalEpisodes} Episodes</span>
                            </div>
                            <div class="p-2">
                                <h5 class="series-title">${series.title}</h5>
                            </div>
                        </div>
                    </div>
                `;
                
                delay += 100;
            }
            
            if (!hasResults) {
                grid.innerHTML = '<div class="col-12 text-center"><p>No series match your search</p></div>';
            }
        }
        
        // Show movie details
        function showMovieDetails(movieId) {
            const movie = allMovies[movieId];
            if (!movie) return;
            
            // Get categories array
            const categories = Array.isArray(movie.categories) ? movie.categories : [];
            
            document.getElementById('movieModalTitle').textContent = movie.title;
            document.getElementById('modalMoviePoster').src = movie.posterUrl || 'https://via.placeholder.com/300x450';
            document.getElementById('modalMovieDescription').textContent = movie.description || 'No description available.';
            document.getElementById('modalMovieYear').textContent = `Year: ${movie.year || 'N/A'}`;
            document.getElementById('modalMovieRating').innerHTML = `<i class="fas fa-star text-warning"></i> ${movie.rating || 'N/A'}`;
            document.getElementById('modalMovieDuration').textContent = movie.duration ? `${movie.duration} minutes` : 'N/A';
            
            // Render categories in modal
            const categoriesContainer = document.getElementById('modalMovieCategories');
            categoriesContainer.innerHTML = '';
            categories.forEach(catId => {
                const categoryName = allCategories[catId]?.name || 'Unknown';
                categoriesContainer.innerHTML += `<span class="badge category-badge me-2 mb-2">${categoryName}</span>`;
            });
            
            // Render download links
            const downloadLinksContainer = document.getElementById('modalMovieDownloadLinks');
            downloadLinksContainer.innerHTML = ''; // Clear previous links

            const downloadLinks = movie.downloadLinks || [];

            if (downloadLinks.length > 0) {
                downloadLinks.forEach(link => {
                    const qualityText = link.quality || 'Download';
                    const downloadButton = `
                        <a href="${link.url}" class="btn quality-btn" download target="_blank">
                            <i class="fas fa-download me-1"></i> ${qualityText}
                        </a>
                    `;
                    downloadLinksContainer.innerHTML += downloadButton;
                });
            } else if (movie.downloadUrl) { // For backward compatibility
                const downloadButton = `
                    <a href="${movie.downloadUrl}" class="btn btn-download" download target="_blank">
                        <i class="fas fa-download me-2"></i> Download
                    </a>
                `;
                downloadLinksContainer.innerHTML = downloadButton;
            } else {
                downloadLinksContainer.innerHTML = '<p class="text-muted">No download links available.</p>';
            }
            
            movieDetailsModal.show();
        }
        
        // Show series details
        function showSeriesDetails(seriesId) {
            const series = allSeries[seriesId];
            if (!series) return;
            
            // Get categories array
            const categories = Array.isArray(series.categories) ? series.categories : [];
            
            document.getElementById('seriesModalTitle').textContent = series.title;
            document.getElementById('modalSeriesPoster').src = series.posterUrl || 'https://via.placeholder.com/300x450';
            document.getElementById('modalSeriesDescription').textContent = series.description || 'No description available.';
            document.getElementById('modalSeriesYear').textContent = `Year: ${series.year || 'N/A'}`;
            document.getElementById('modalSeriesRating').innerHTML = `<i class="fas fa-star text-warning"></i> ${series.rating || 'N/A'}`;
            
            // Calculate total seasons and episodes
            let totalSeasons = 0;
            let totalEpisodes = 0;
            
            if (series.seasons) {
                totalSeasons = Object.keys(series.seasons).length;
                for (const season in series.seasons) {
                    if (series.seasons[season].episodes) {
                        totalEpisodes += Object.keys(series.seasons[season].episodes).length;
                    }
                }
            }
            
            document.getElementById('modalSeriesSeasons').textContent = `${totalSeasons} Seasons`;
            document.getElementById('modalSeriesEpisodes').textContent = `${totalEpisodes} Episodes`;
            
            // Render categories in modal
            const categoriesContainer = document.getElementById('modalSeriesCategories');
            categoriesContainer.innerHTML = '';
            categories.forEach(catId => {
                const categoryName = allCategories[catId]?.name || 'Unknown';
                categoriesContainer.innerHTML += `<span class="badge category-badge me-2 mb-2">${categoryName}</span>`;
            });
            
            // Render seasons and episodes
            const seasonNav = document.getElementById('seasonNav');
            const episodesContainer = document.getElementById('episodesContainer');
            
            seasonNav.innerHTML = '';
            episodesContainer.innerHTML = '';
            
            if (series.seasons) {
                // Sort seasons numerically
                const sortedSeasons = Object.keys(series.seasons).sort((a, b) => parseInt(a) - parseInt(b));
                
                sortedSeasons.forEach((seasonNum, index) => {
                    const season = series.seasons[seasonNum];
                    
                    // Add season button
                    const seasonBtn = document.createElement('button');
                    seasonBtn.className = `season-btn ${index === 0 ? 'active' : ''}`;
                    seasonBtn.textContent = `Season ${seasonNum}`;
                    seasonBtn.onclick = () => showSeasonEpisodes(seasonNum);
                    seasonNav.appendChild(seasonBtn);
                    
                    // Add episode list
                    const episodeList = document.createElement('div');
                    episodeList.id = `season-${seasonNum}-episodes`;
                    episodeList.className = `episode-list ${index === 0 ? 'active' : ''}`;
                    
                    if (season.episodes) {
                        // Sort episodes numerically
                        const sortedEpisodes = Object.keys(season.episodes).sort((a, b) => parseInt(a) - parseInt(b));
                        
                        sortedEpisodes.forEach(episodeNum => {
                            const episode = season.episodes[episodeNum];
                            
                            const episodeItem = document.createElement('div');
                            episodeItem.className = 'episode-item';
                            episodeItem.innerHTML = `
                                <div class="episode-title">Episode ${episodeNum}</div>
                                <div class="episode-download">
                                    <span class="text-muted">Download:</span>
                                    <a href="${episode.downloadUrl}" class="btn btn-sm btn-download" download="${series.title.replace(/\s+/g, '_')}_S${seasonNum}E${episodeNum}.mp4">
                                        <i class="fas fa-download me-1"></i> Download
                                    </a>
                                </div>
                            `;
                            episodeList.appendChild(episodeItem);
                        });
                    } else {
                        episodeList.innerHTML = '<p>No episodes available for this season</p>';
                    }
                    
                    episodesContainer.appendChild(episodeList);
                });
            } else {
                episodesContainer.innerHTML = '<p>No seasons available</p>';
            }
            
            seriesDetailsModal.show();
        }
        
        // Function to switch between seasons
        function showSeasonEpisodes(seasonNum) {
            // Update active season button
            const seasonBtns = document.querySelectorAll('.season-btn');
            seasonBtns.forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === `Season ${seasonNum}`) {
                    btn.classList.add('active');
                }
            });
            
            // Update active episode list
            const episodeLists = document.querySelectorAll('.episode-list');
            episodeLists.forEach(list => {
                list.classList.remove('active');
                if (list.id === `season-${seasonNum}-episodes`) {
                    list.classList.add('active');
                }
            });
        }
        
        // Initialize when page loads
        window.onload = loadData;
    </script>
</body>
</html>